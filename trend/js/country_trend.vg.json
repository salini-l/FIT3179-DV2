{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/salini-l/FIT3179-DV2/refs/heads/main/trend/data/temp_change_country_year.csv"
  },
  "vconcat": [
    {
      "title": {
        "text": "Temperature Anomaly Over Time in Australia",
        "subtitle": "Annual mean ΔT vs 1960 baseline (°C)",
        "dy": 8
      },
      "width": 900,
      "height": 340,
      "padding": 10,
      "transform": [
        { "filter": "datum.Area == 'Australia'" },
        { "filter": { "param": "year_brush" } }
      ],
      "encoding": {
        "x": {
          "field": "Year",
          "type": "quantitative",
          "title": "Year",
          "scale": { "zero": false },
          "axis": {
            "values": [1960,1970,1980,1990,2000,2010,2020],
            "format": "d",
            "labelOverlap": "greedy",
            "labelPadding": 6
          }
        },
        "y": {
          "field": "TempChange_C",
          "type": "quantitative",
          "title": "ΔT vs 1960 (°C)",
          "axis": { "tickCount": 6, "labelPadding": 4 },
          "scale": { "domain": [-1.1, 2.5] }
        }
      },
      "layer": [
        {
          "transform": [
            {
              "aggregate": [
                { "op": "mean", "field": "TempChange_C", "as": "MeanDT" },
                { "op": "min",  "field": "Year",          "as": "YearMin" },
                { "op": "max",  "field": "Year",          "as": "YearMax" }
              ]
            },
            { "calculate": "datum.YearMax - 0.5", "as": "LabelX" }
          ],
          "layer": [
            {
              "mark": { "type": "rule", "stroke": "#ef4444", "strokeWidth": 2, "opacity": 0.9, "strokeCap": "butt" },
              "encoding": {
                "x":  { "field": "YearMin", "type": "quantitative" },
                "x2": { "field": "YearMax" },
                "y":  { "field": "MeanDT",  "type": "quantitative" }
              }
            },
            {
              "mark": { "type": "text", "align": "left", "dx": 6, "dy": -6, "fontSize": 12, "fill": "#ef4444" },
              "encoding": {
                "x": { "field": "LabelX", "type": "quantitative" },
                "y": { "field": "MeanDT", "type": "quantitative" },
                "text": { "value": "Mean ΔT" }
              }
            }
          ]
        },
        {
          "mark": { "type": "line", "interpolate": "monotone", "strokeWidth": 2 },
          "encoding": { "order": { "field": "Year" } }
        },
        {
          "mark": { "type": "point", "filled": true, "size": 30 },
          "encoding": {
            "tooltip": [
              { "field": "Area", "title": "Country" },
              { "field": "Year", "title": "Year", "format": "d" },
              { "field": "TempChange_C", "title": "Warming vs baseline (°C)", "format": "+.2f" }
            ]
          }
        }
      ],
      "config": {
        "title": { "fontSize": 18, "subtitleFontSize": 13, "anchor": "start" },
        "axis": { "grid": true },
        "view": { "stroke": null }
      }
    },

    {
      "width": 900,
      "height": 70,
      "transform": [
        { "filter": "datum.Area == 'Australia'" }
      ],
      "mark": { "type": "line", "strokeWidth": 1.5 },
      "params": [
        {
          "name": "year_brush",
          "select": { "type": "interval", "encodings": ["x"] }
        }
      ],
      "encoding": {
        "x": {
          "field": "Year",
          "type": "quantitative",
          "axis": { "title": "", "format": "d" }
        },
        "y": {
          "field": "TempChange_C",
          "type": "quantitative",
          "axis": { "title": "", "ticks": false, "labels": false, "grid": false }
        }
      }
    }
  ]
}

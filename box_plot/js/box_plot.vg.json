{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": { "text": "Annual Temperature Anomalies by Decade in Australia" },
  "width": 900,
  "height": 360,

  "data": {
    "url": "https://raw.githubusercontent.com/salini-l/FIT3179-DV2/refs/heads/main/box_plot/data/temp_change_country_year.csv"
  },

  "transform": [
    { "filter": "datum.Area == 'Australia'" },
    { "calculate": "floor(datum.Year/10)*10", "as": "DecadeNum" },
    { "calculate": "toString(datum.DecadeNum)", "as": "Decade" },
    { "filter": "datum.DecadeNum >= 1960 && datum.DecadeNum <= 2010" },
    {
      "window": [
        { "op": "rank", "as": "year_rank" },          
        { "op": "count", "as": "year_count" }
      ],
      "groupby": ["DecadeNum"],
      "sort": [{ "field": "Year", "order": "ascending" }]
    },
    {
      "calculate": "((datum.year_rank - 1) / (datum.year_count - 1) - 0.5) * 30",
      "as": "x_jitter"
    }
  ],

  "layer": [
    {
      "mark": { "type": "rule", "stroke": "#9ca3af", "strokeDash": [4,4] },
      "encoding": { "y": { "datum": 0 } }
    },

    {
      "mark": { "type": "boxplot", "extent": "min-max", "median": {"color": "#111827"} },
      "encoding": {
        "x": {
          "field": "Decade",
          "type": "nominal",
          "sort": ["1960","1970","1980","1990","2000","2010"],
          "axis": { "labelAngle": 0, "labelPadding": 8, "title": "Decade" }
        },
        "y": { "field": "TempChange_C", "type": "quantitative", "title": "Temperature Change (°C)" },
        "color": { "value": "#9ca3af" },
        "tooltip": true
      }
    },

    {
      "mark": { "type": "point", "filled": true, "size": 36, "opacity": 0.7 },
      "encoding": {
        "x": {
          "field": "Decade",
          "type": "nominal",
          "sort": ["1960","1970","1980","1990","2000","2010"],
          "axis": { "labelAngle": 0 },
          "bandPosition": 0.5
        },
        "xOffset": { "field": "x_jitter", "type": "quantitative" },   
        "y": { "field": "TempChange_C", "type": "quantitative" },
        "detail": { "field": "Year" },
        "color": {
          "field": "TempChange_C", "type": "quantitative",
          "title": "Temperature Change (°C)",
          "scale": {
            "type": "threshold",
            "domain": [0.5, 1.0, 1.5, 2.0],
            "range": ["#fee5d9","#fcbba1","#fb6a4a","#ef3b2c","#cb181d"]
          }
        },
        "tooltip": [
          { "field": "Year", "title": "Year", "format": "d" },
          { "field": "TempChange_C", "title": "ΔT (°C)", "format": "+.2f" }
        ]
      }
    }
  ],

  "config": {
    "axis": { "grid": true },
    "view": { "stroke": null },
    "legend": { "titleFontSize": 12, "labelFontSize": 11 }
  }
}


